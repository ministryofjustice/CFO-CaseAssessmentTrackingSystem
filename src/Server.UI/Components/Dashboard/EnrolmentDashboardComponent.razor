@using Cfo.Cats.Application.Features.Dashboard.Queries
@inherits CatsComponent<GetEnrolments.EnrolmentDto>

@if(Loading)
{
	<MudLoading Text="Loading" />
}

@if (ErrorMessage is not null)
{
	<MudAlert Variant="Variant.Filled" Severity="Severity.Error">
		@ErrorMessage
	</MudAlert>
}

@if (Data is not null && Data.Details.Any())
{
    <MudGrid Spacing="2">
        <MudItem>
            <MudChip T="string">Custody (@Data.Custody)</MudChip>
            <MudChip T="string">Community (@Data.Community)</MudChip>
        </MudItem>
    </MudGrid>

	@if (VisualMode)
	{
		<ApexCharts.ApexChart TItem="GetEnrolments.LocationDetail" Options="Options" Height="650" Width="@("100%")">
            <ApexCharts.ApexPointSeries TItem="GetEnrolments.LocationDetail"
										Items="Data.Details"
										SeriesType="ApexCharts.SeriesType.Bar"
                                        XValue="@(e => e.LocationName)"
										YValue="@(e => e.Payable)"
										Name="Payable"
										ShowDataLabels="true">

			</ApexCharts.ApexPointSeries>
		</ApexCharts.ApexChart>
	}
	else
	{
		<MudTable Items="@Data.Details" MultiSelection="false" Striped="true" Hover="true">
			<HeaderContent>
                <MudTh>
                    <MudTableSortLabel SortBy="new Func<GetEnrolments.LocationDetail, object>(x => x.LocationName)">
                        Location
                    </MudTableSortLabel>
                </MudTh>
                <MudTh>
                    <MudTableSortLabel SortBy="new Func<GetEnrolments.LocationDetail, object>(x => x.LocationType.Name)">
                        LocationType
                    </MudTableSortLabel>
                </MudTh>
                <MudTh>
                    <MudTableSortLabel SortBy="new Func<GetEnrolments.LocationDetail, object>(x => x.Payable)">
                        Payable
                    </MudTableSortLabel>
                </MudTh>
			</HeaderContent>
			<RowTemplate>
                <MudTd DataLabel="Location">@context.LocationName</MudTd>
				<MudTd DataLabel="Location Type">@context.LocationType.Name</MudTd>
				<MudTd DataLabel="Count">@context.Payable</MudTd>
			</RowTemplate>
			<PagerContent>
				<MudTablePager PageSizeOptions="new int[] { 10, 20 }" />
			</PagerContent>
		</MudTable>
	}

}
else
{
    <MudText Typo="Typo.body2" Color="Color.Secondary" Align="MudBlazor.Align.Center">No data available</MudText>
}