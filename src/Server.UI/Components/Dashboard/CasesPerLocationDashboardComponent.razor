@using ActualLab.Fusion.Extensions
@using ApexCharts
@using Cfo.Cats.Application.Features.Dashboard.Queries
@using Cfo.Cats.Domain.Common.Enums

@inherits CatsComponent<GetCasesPerLocation.CasesPerLocationDto>

@if (Loading)
{
    <MudLoading Text="Loading" />
}

@if (ErrorMessage is not null)
{
    <MudAlert Variant="Variant.Filled" Severity="Severity.Error">
        @ErrorMessage
    </MudAlert>
}

@if (Data is not null && Data.Records.Any())
{
    <MudGrid Spacing="2">
        <!-- This is the left column -->
        <MudItem>
            <MudChip T="string">Custody (@Data.Custody)</MudChip>
            <MudChip T="string">Community (@Data.Community)</MudChip>
        </MudItem>
    </MudGrid>
    @if(VisualMode)
    {
        <ApexChart TItem="GetCasesPerLocation.LocationDetail" Options="Options" Height="700">
			@{
				var chartData = ChartData();
				var statuses = chartData.Select(x => x.Status).OrderBy(x => x.LogicalOrder).Distinct();
			}
			@foreach (var status in statuses)
			{
                <ApexPointSeries TItem="GetCasesPerLocation.LocationDetail"
									Name="@status.Name"
									Items="@chartData.Where(x => x.Status == status).ToList()"
									XValue="@(x => x.LocationName)"
									YValue="@(x => x.Count)"
									SeriesType="SeriesType.Bar"
									ShowDataLabels
									Color="@status.Colour" />
			}
		</ApexChart>
    }
    else
    {
        <MudTable Items="Data.Records"
                    Hover="true"
                    Striped="true"
					>
            <HeaderContent>
                <MudTh>
                    <MudTableSortLabel SortBy="new Func<GetCasesPerLocation.LocationDetail, object>(x => x.LocationName)">
                        Location
                    </MudTableSortLabel>
                </MudTh>
                <MudTh>
                    <MudTableSortLabel SortBy="new Func<GetCasesPerLocation.LocationDetail, object>(x => x.LocationType.Name)">
                        LocationType
                    </MudTableSortLabel>
                </MudTh>
                <MudTh>
                    <MudTableSortLabel SortBy="new Func<GetCasesPerLocation.LocationDetail, object>(x => x.Status.Name)">
                        Status
                    </MudTableSortLabel>
                </MudTh>
                <MudTh>
                    <MudTableSortLabel SortBy="new Func<GetCasesPerLocation.LocationDetail, object>(x => x.Count)">
                        Count
                    </MudTableSortLabel>
                </MudTh>
            </HeaderContent>
            <RowTemplate>
                <MudTd DataLabel="Location">@context.LocationName</MudTd>
                <MudTd DataLabel="LocationType">@context.LocationType</MudTd>
                <MudTd DataLabel="Status">@context.Status</MudTd>
                <MudTd DataLabel="Count">@context.Count</MudTd>
            </RowTemplate>

        </MudTable>
    }
}
else
{
    <MudText Typo="Typo.body2" Color="Color.Secondary" Align="MudBlazor.Align.Center">No data available</MudText>
}