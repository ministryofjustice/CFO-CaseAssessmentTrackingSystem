@using Cfo.Cats.Application.Features.Participants.Commands
@using Cfo.Cats.Domain.Identity
@inherits CatsComponentBase

@inject IValidationService Validator

@inject IStringLocalizer<ReassignParticipantDialog> L

<MudDialog>
    <DialogContent>
        <MudForm Model="Model" @ref="_form" Validation="@(Validator.ValidateValue(Model))">
            <MudGrid>
                <MudItem xs="12">
                    <MudText Typo="Typo.body2">
                        Reassign @Model!.ParticipantIdsToReassign.Length @(Model.ParticipantIdsToReassign.Length == 1 ? "participant" : "participants")
                    </MudText>
                </MudItem>
                <MudItem xs="12">
                    @if (_userManager is not null)
                    {
                        <MudSelect T="string" Style="min-width:650px" @bind-Value="Model!.AssigneeId" Dense="true" Required="true">
                            @foreach (var item in _userManager.Users
                                          .Where(x => x.TenantId!.StartsWith(UserProfile!.TenantId!))
                                          .Where(x => x.IsActive)
                                          .Where(x => x.LockoutEnd == null)
                                          .OrderBy((x => x.DisplayName)))
                            {
                                <MudSelectItem T="string" Value="@item.Id">@item.DisplayName</MudSelectItem>
                            }
                        </MudSelect>
                    }
                </MudItem>
            </MudGrid>
            
        </MudForm>
    </DialogContent>
    <DialogActions>
        <MudButton Color="Color.Secondary" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Cancel" OnClick="Cancel">@ConstantString.Cancel</MudButton>
        <MudLoadingButton Color="Color.Primary" Variant="Variant.Filled" StartIcon="@Icons.Material.Filled.Save" Loading="@_saving" OnClick="Submit">@ConstantString.Submit</MudLoadingButton>
    </DialogActions>
</MudDialog>