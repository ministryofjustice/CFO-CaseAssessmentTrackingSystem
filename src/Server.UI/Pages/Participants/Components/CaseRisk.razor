@using Cfo.Cats.Application.Features.Participants.DTOs
@using Cfo.Cats.Application.Features.Participants.Queries
@using Cfo.Cats.Domain.Common.Enums

@inherits CatsComponentBase

<style>
    .readonly-toggle {
        pointer-events: none; 
    }
</style>

@if (_notFound)
{
    <MudAlert>
        <MudAlert Severity="Severity.Info" Variant="Variant.Outlined" Square="true" Class="my-2">No risk information found.</MudAlert>
    </MudAlert>
}

@if(_model is not null)
{
    <MudForm ReadOnly>
        <MudExpansionPanels>
            <MudExpansionPanel>
                <TitleContent>
                    <MudText>@_model.GetMemberDescription(x => x.LicenseConditions)</MudText>
                </TitleContent>
                <ChildContent>
                    <MudTextField Value="@_model.LicenseConditions" Lines="5" Label="Condition(s)" Placeholder="All conditions must be relevant to the Participant and linked to their involvement to the CFO Evolution Programme. This must be clear and concise, e.g. exclusion zone in place which restricts XX from entering XX City Centre."></MudTextField>
                </ChildContent>
            </MudExpansionPanel>
            <MudExpansionPanel>
                <TitleContent>
                    <MudText>Risk Overview</MudText>
                </TitleContent>
                <ChildContent>
                    <MudGrid>
                        @* Risk to Children *@
                        <MudItem xs="4">
                            @_model.GetMemberDescription(x => x.RiskToChildren)
                        </MudItem>
                        <MudItem xs="8">
                            <MudToggleGroup Value="@_model.RiskToChildren" Class="readonly-toggle" CheckMark>
                                <MudToggleItem Value="@RiskLevel.Low">@RiskLevel.Low.Name</MudToggleItem>
                                <MudToggleItem Value="@RiskLevel.Medium">@RiskLevel.Medium.Name</MudToggleItem>
                                <MudToggleItem Value="@RiskLevel.High">@RiskLevel.High.Name</MudToggleItem>
                                <MudToggleItem Value="@RiskLevel.VeryHigh">@RiskLevel.VeryHigh.Name</MudToggleItem>
                            </MudToggleGroup>
                        </MudItem>
                        @* Risk to Public *@
                        <MudDivider Class="mt-6" />
                        <MudItem xs="4">
                            @_model.GetMemberDescription(x => x.RiskToPublic)
                        </MudItem>
                        <MudItem xs="8">
                            <MudToggleGroup Value="@_model.RiskToPublic" Class="readonly-toggle" CheckMark>
                                <MudToggleItem Value="@RiskLevel.Low">@RiskLevel.Low.Name</MudToggleItem>
                                <MudToggleItem Value="@RiskLevel.Medium">@RiskLevel.Medium.Name</MudToggleItem>
                                <MudToggleItem Value="@RiskLevel.High">@RiskLevel.High.Name</MudToggleItem>
                                <MudToggleItem Value="@RiskLevel.VeryHigh">@RiskLevel.VeryHigh.Name</MudToggleItem>
                            </MudToggleGroup>
                        </MudItem>
                        @* Risk to Known Adult *@
                        <MudDivider Class="mt-6" />
                        <MudItem xs="4">
                            @_model.GetMemberDescription(x => x.RiskToKnownAdult)
                        </MudItem>
                        <MudItem xs="8">
                            <MudToggleGroup Value="@_model.RiskToKnownAdult" Class="readonly-toggle" CheckMark>
                                <MudToggleItem Value="@RiskLevel.Low">@RiskLevel.Low.Name</MudToggleItem>
                                <MudToggleItem Value="@RiskLevel.Medium">@RiskLevel.Medium.Name</MudToggleItem>
                                <MudToggleItem Value="@RiskLevel.High">@RiskLevel.High.Name</MudToggleItem>
                                <MudToggleItem Value="@RiskLevel.VeryHigh">@RiskLevel.VeryHigh.Name</MudToggleItem>
                            </MudToggleGroup>
                        </MudItem>
                        @* Risk to Staff *@
                        <MudDivider Class="mt-6" />
                        <MudItem xs="4">
                            @_model.GetMemberDescription(x => x.RiskToStaff)
                        </MudItem>
                        <MudItem xs="8">
                            <MudToggleGroup Value="@_model.RiskToStaff" Class="readonly-toggle" CheckMark>
                                <MudToggleItem Value="@RiskLevel.Low">@RiskLevel.Low.Name</MudToggleItem>
                                <MudToggleItem Value="@RiskLevel.Medium">@RiskLevel.Medium.Name</MudToggleItem>
                                <MudToggleItem Value="@RiskLevel.High">@RiskLevel.High.Name</MudToggleItem>
                                <MudToggleItem Value="@RiskLevel.VeryHigh">@RiskLevel.VeryHigh.Name</MudToggleItem>
                            </MudToggleGroup>
                        </MudItem>
                        @* Risk to Other Prisoners *@
                        <MudDivider Class="mt-6" />
                        <MudItem xs="4">
                            @_model.GetMemberDescription(x => x.RiskToOtherPrisoners)
                        </MudItem>
                        <MudItem xs="8">
                            <MudToggleGroup Value="@_model.RiskToOtherPrisoners" Class="readonly-toggle" CheckMark>
                                <MudToggleItem Value="@RiskLevel.Low">@RiskLevel.Low.Name</MudToggleItem>
                                <MudToggleItem Value="@RiskLevel.Medium">@RiskLevel.Medium.Name</MudToggleItem>
                                <MudToggleItem Value="@RiskLevel.High">@RiskLevel.High.Name</MudToggleItem>
                                <MudToggleItem Value="@RiskLevel.VeryHigh">@RiskLevel.VeryHigh.Name</MudToggleItem>
                            </MudToggleGroup>
                        </MudItem>
                        @* Risk to Self *@
                        <MudDivider Class="mt-6" />
                        <MudItem xs="4">
                            @_model.GetMemberDescription(x => x.RiskToSelf)
                        </MudItem>
                        <MudItem xs="8">
                            <MudToggleGroup Value="@_model.RiskToSelf" Class="readonly-toggle" CheckMark>
                                <MudToggleItem Value="@RiskLevel.Low">@RiskLevel.Low.Name</MudToggleItem>
                                <MudToggleItem Value="@RiskLevel.Medium">@RiskLevel.Medium.Name</MudToggleItem>
                                <MudToggleItem Value="@RiskLevel.High">@RiskLevel.High.Name</MudToggleItem>
                                <MudToggleItem Value="@RiskLevel.VeryHigh">@RiskLevel.VeryHigh.Name</MudToggleItem>
                            </MudToggleGroup>
                        </MudItem>
                        @* Risk to Self *@
                        <MudDivider Class="mt-6" />
                        <MudItem xs="4">
                            Risk Details above are relevant to
                        </MudItem>
                        <MudItem xs="8" Class="d-flex">
                            <MudCheckBox Value="@(_model.IsRelevantToCustody ?? false)" Label="@_model.GetMemberDescription(x => x.IsRelevantToCustody)"/>
                            <MudCheckBox Value="@(_model.IsRelevantToCommunity ?? false)" Label="@_model.GetMemberDescription(x => x.IsRelevantToCommunity)" />
                        </MudItem>
                    </MudGrid>
                </ChildContent>
            </MudExpansionPanel>
            <MudExpansionPanel>
                <TitleContent>
                    <MudText>MAPPA</MudText>
                </TitleContent>
                <ChildContent>
                    <MudGrid>
                        @* MAPPA Category *@
                        <MudItem xs="4">
                            Category
                        </MudItem>
                        <MudItem xs="8">
                            <MudToggleGroup Class="readonly-toggle" Value="@_model.MappaCategory" CheckMark>
                                <MudToggleItem Value="@MappaCategory.Category1">@MappaCategory.Category1.Name</MudToggleItem>
                                <MudToggleItem Value="@MappaCategory.Category2">@MappaCategory.Category2.Name</MudToggleItem>
                                <MudToggleItem Value="@MappaCategory.Category3">@MappaCategory.Category3.Name</MudToggleItem>
                            </MudToggleGroup>
                        </MudItem>
                        @* MAPPA Category *@
                        <MudDivider Class="mt-6" />
                        <MudItem xs="4">
                            Level
                        </MudItem>
                        <MudItem xs="8">
                            <MudToggleGroup Class="readonly-toggle" Value="@_model.MappaLevel" CheckMark>
                                <MudToggleItem Value="@MappaLevel.Level1">@MappaLevel.Level1.Name</MudToggleItem>
                                <MudToggleItem Value="@MappaLevel.Level2">@MappaLevel.Level2.Name</MudToggleItem>
                                <MudToggleItem Value="@MappaLevel.Level3">@MappaLevel.Level3.Name</MudToggleItem>
                            </MudToggleGroup>
                        </MudItem>
                    </MudGrid>
                </ChildContent>
            </MudExpansionPanel>
            <MudExpansionPanel>
                <TitleContent>
                    <MudText>@_model.GetMemberDescription(x => x.IsSubjectToSHPO)</MudText>
                </TitleContent>
                <ChildContent>
                    <MudGrid>
                        @* Sexual Harm Prevention Order *@
                        <MudItem xs="4">
                            Is the person subject to a @_model.GetMemberDescription(x => x.IsSubjectToSHPO)
                        </MudItem>
                        <MudItem xs="8">
                            <MudToggleGroup Class="readonly-toggle" Value="@_model.IsSubjectToSHPO" CheckMark>
                                <MudToggleItem Value="(bool?)true">Yes</MudToggleItem>
                                <MudToggleItem Value="(bool?)false">No</MudToggleItem>
                            </MudToggleGroup>
                        </MudItem>
                        @* NSD Case *@
                        <MudItem xs="4">
                            @_model.GetMemberDescription(x => x.NSDCase)
                        </MudItem>
                        <MudItem xs="8">
                            <MudTextField Placeholder="@_model.GetMemberDescription(x => x.NSDCase)" Value="@_model.NSDCase"/>
                        </MudItem>
                    </MudGrid>
                </ChildContent>
            </MudExpansionPanel>
            <MudExpansionPanel>
                <TitleContent>
                    <MudText>@_model.GetMemberDescription(x => x.SpecificRisk)</MudText>
                </TitleContent>
                <ChildContent>
                    <MudTextField Value="@_model.SpecificRisk" Lines="5" Label="Restrictions(s)" Placeholder="Specific risk (to females, LGBT etc.)"></MudTextField>
                </ChildContent>
            </MudExpansionPanel>
            <MudExpansionPanel>
                <TitleContent>
                    <MudText>Activity Recommendations</MudText>
                </TitleContent>
                <ChildContent>
                    <MudTextField Value="@_model.ActivityRecommendations" Lines="5" Label="Recommendation(s)" Placeholder="Consider any activities we could deliver to support any mandated accredited programmes which are required as part of the license conditions such as CSAAP course, unpaid work, substance misuse, exclusion zones. Also Support required for the Participant e.g. broken family links, debt, accommodation or education and training."></MudTextField>
                </ChildContent>
            </MudExpansionPanel>
            <MudExpansionPanel>
                <TitleContent>
                    <MudText>Activity Restrictions</MudText>
                </TitleContent>
                <ChildContent>
                    <MudTextField Value="@_model.ActivityRestrictions" Lines="5" Label="Restrictions(s)" Placeholder="Include here any activity that you are aware of at this time that would not be appropriate."></MudTextField>
                </ChildContent>
            </MudExpansionPanel>
            <MudExpansionPanel>
                <TitleContent>
                    <MudText>Additional Information</MudText>
                </TitleContent>
                <ChildContent>
                    <MudTextField Value="@_model.AdditionalInformation" Lines="5" Label="Comment(s)" Placeholder="Use this area to provide any additional information (i.e. information that might support the Risk Overview rating, or relevant information that has not already been documented in this template)."></MudTextField>
                </ChildContent>
            </MudExpansionPanel>
        </MudExpansionPanels>
    </MudForm>
}

@code {
    [Parameter]
    [EditorRequired]
    public string ParticipantId { get; set; } = default!;

    private RiskDto? _model;
    private bool _notFound = false;

    protected override async Task OnInitializedAsync()
    {
        try
        {
            var result = await GetNewMediator().Send(new GetParticipantRisk.Query()
            {
                ParticipantId = ParticipantId
            });

            if(result.Succeeded && result.Data is not null)
            {
                _model = result.Data;
            }
            else
            {
                _notFound = true;
            }

        }
        catch (NotFoundException)
        {
            _notFound = true;
        }
        finally
        {
            await base.OnInitializedAsync();
        }

    }
}
