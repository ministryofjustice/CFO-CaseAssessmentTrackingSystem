@using Cfo.Cats.Application.Features.Assessments.Commands
@using Cfo.Cats.Application.Features.Participants.DTOs

<MudGrid Class="pa-3" Spacing="4">
    <MudItem xs="12" md="4">
        <MudCard Style="Height: 100%; Max-Height: 192px">
            <MudCardHeader>
                <CardHeaderContent>
                    <MudText Typo="Typo.h6">Latest Assessment</MudText>
                </CardHeaderContent>
                <CardHeaderActions>
                    <MudIconButton Icon="@Icons.Material.Filled.Info" Color="Color.Info" />
                </CardHeaderActions>
            </MudCardHeader>
            <MudCardContent Class="d-flex justify-space-between align-center">
                <MudText Typo="Typo.body2">No assessment found</MudText>
                <MudButton Color="Color.Primary" Variant="Variant.Filled" Size="Size.Small" OnClick="BeginAssessment">Begin</MudButton>
            </MudCardContent>
        </MudCard>
    </MudItem>
</MudGrid>

@code {


    [CascadingParameter] 
    public ParticipantDto ParticipantDto { get; set; } = default!;

    public async Task BeginAssessment()
    {
        var command = new BeginAssessment.Command()
        {
            ParticipantId = this.ParticipantDto.Id
        };
        var result = await Mediator.Send(command);

        if (result.Succeeded)
        {
            Navigation.NavigateTo($"/pages/participants/{ParticipantDto.Id}/assessment/{result.Data}");
        }
    }

}