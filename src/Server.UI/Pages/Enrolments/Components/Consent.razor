@using Cfo.Cats.Server.UI.Components.Shared.FileUpload

<MudForm @ref="Form">
    <MudDatePicker Label="Date of Consent" Editable="true" MaxDate="DateTime.UtcNow.Date" Required />
    <div class="mb-4 mt-8">
        <CatsFileUpload UploadText="Upload Consent" Accept=".pdf, .jpeg, .png" FilesChanged="FilesChanged" />

        <MudSelect T="string" Label="Document Version" AnchorOrigin="Origin.BottomCenter" Required>
            @foreach (var version in documentVersions)
            {
                <MudSelectItem Value="@version" />
            }
        </MudSelect>
    </div>

    <MudCheckBox @ref="certify" Disabled="fileCount == 0" T="bool" Required="true" RequiredError="You must upload a document and certify" Label="I certify that any documents uploaded are the original or true copies of the original documents, and will not be used to claim payments / results against any other Government contract" />
</MudForm>

@code {
    MudCheckBox<bool> certify { get; set; } = default!;

    List<string> documentVersions = new List<string>
    {
        "Version 1.1",
        "Version 1.0",
    };

    int fileCount = 0;

    async Task FilesChanged(int fileCount)
    {
        this.fileCount = fileCount;
        await certify.ResetAsync();
        StateHasChanged();
    }

    MudForm? Form { get; set; }

    public async Task<bool> Validate()
    {
        await Task.CompletedTask;
        
        Form?.Validate();
        return Form?.IsValid ?? false;
    }
}
