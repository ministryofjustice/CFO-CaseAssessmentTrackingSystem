@using MudBlazor.Extensions

<MudForm Model="@Criteria" @ref="form" Validation="candidateValidator.ValidateValue" OverrideFieldValidation="HasResult is false" ValidationDelay="0" Disabled="HasResult">
    <MudGrid>
        @*
            if/else: not ideal, but is essential here for the two-stage validation.
            the first stage relies on the form-level validation, and performs a fluent validation on all inputs.
            the second stage uses field-level validation, ensuring the candidate that is shown matches the input criteria.
            if/else is necessary here as you cannot conditionally render the [Validation] attribute as it nukes validation.
        *@
        @if (HasResult)
        {
            <MudItem xs="12">
                <MudTextField Label="Identifier (PNomis Id / NDelius Id)" @bind-Value="Criteria.Identifier" For="(() => Criteria.Identifier)" Immediate="true" Validation="ValidateValue(CandidateResult?.Data.Identifier)" />
            </MudItem>
            <MudItem xs="12">
                <MudTextField Label="First Name" @bind-Value="Criteria.FirstName" For="(() => Criteria.FirstName)" Immediate="true" Validation="ValidateValue(CandidateResult?.Data.FirstName)" />
            </MudItem>
            <MudItem xs="12">
                <MudTextField Label="Last Name" @bind-Value="Criteria.LastName" For="(() => Criteria.LastName)" Immediate="true" Validation="ValidateValue(CandidateResult?.Data.LastName)" />
            </MudItem>
            <MudItem xs="12">
                <MudDatePicker Label="Date Of Birth" @bind-Date="Criteria.DateOfBirth" For="(() => Criteria.DateOfBirth)" ImmediateText="true" Validation="ValidateValue(CandidateResult?.Data.DateOfBirth!.Value.ToIsoDateString())"/>
            </MudItem>
        }
        else
        {
            <MudItem xs="12">
                <MudTextField Label="Identifier (PNomis Id / NDelius Id)" @bind-Value="Criteria.Identifier" For="(() => Criteria.Identifier)" Immediate="true" />
            </MudItem>
            <MudItem xs="12">
                <MudTextField Label="First Name" @bind-Value="Criteria.FirstName" For="(() => Criteria.FirstName)" Immediate="true" />
            </MudItem>
            <MudItem xs="12">
                <MudTextField Label="Last Name" @bind-Value="Criteria.LastName" For="(() => Criteria.LastName)" Immediate="true" />
            </MudItem>
            <MudItem xs="12">
                <MudDatePicker Label="Date Of Birth" @bind-Date="Criteria.DateOfBirth" For="(() => Criteria.DateOfBirth)" ImmediateText="true" Editable="true" MaxDate="DateTime.UtcNow.Date" />
            </MudItem>
        }
    </MudGrid>
</MudForm>