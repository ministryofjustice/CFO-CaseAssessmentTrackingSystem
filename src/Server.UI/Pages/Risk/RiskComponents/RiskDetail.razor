@using Cfo.Cats.Application.Features.Participants.DTOs
@using Cfo.Cats.Domain.Common.Enums

<MudForm Model="Model" Validation="Validator.ValidateValue(Model)">
    <MudGrid>
        <MudItem xs="4">
            @Model.GetMemberDescription(x => x.RiskToChildren)
        </MudItem>
        <MudItem xs="8">
            <MudToggleGroup @bind-Value="@Model.RiskToChildren" Class="readonly-toggle" CheckMark>
                <MudToggleItem Value="@RiskLevel.Unknown">@RiskLevel.Unknown.Name</MudToggleItem>
                <MudToggleItem Value="@RiskLevel.Low">@RiskLevel.Low.Name</MudToggleItem>
                <MudToggleItem Value="@RiskLevel.Medium">@RiskLevel.Medium.Name</MudToggleItem>
                <MudToggleItem Value="@RiskLevel.High">@RiskLevel.High.Name</MudToggleItem>
                <MudToggleItem Value="@RiskLevel.VeryHigh">@RiskLevel.VeryHigh.Name</MudToggleItem>
            </MudToggleGroup>
            <MudTextField ReadOnly Underline="false" For="@(() => Model.RiskToChildren)" hidden />
        </MudItem>
        @* Risk to Public *@
        <MudDivider Class="mt-6" />
        <MudItem xs="4">
            @Model.GetMemberDescription(x => x.RiskToPublic)
        </MudItem>
        <MudItem xs="8">
            <MudToggleGroup @bind-Value="@Model.RiskToPublic" Class="readonly-toggle" CheckMark>
                <MudToggleItem Value="@RiskLevel.Unknown">@RiskLevel.Unknown.Name</MudToggleItem>
                <MudToggleItem Value="@RiskLevel.Low">@RiskLevel.Low.Name</MudToggleItem>
                <MudToggleItem Value="@RiskLevel.Medium">@RiskLevel.Medium.Name</MudToggleItem>
                <MudToggleItem Value="@RiskLevel.High">@RiskLevel.High.Name</MudToggleItem>
                <MudToggleItem Value="@RiskLevel.VeryHigh">@RiskLevel.VeryHigh.Name</MudToggleItem>
            </MudToggleGroup>
            <MudTextField ReadOnly Underline="false" For="@(() => Model.RiskToPublic)" hidden />
        </MudItem>
        @* Risk to Known Adult *@
        <MudDivider Class="mt-6" />
        <MudItem xs="4">
            @Model.GetMemberDescription(x => x.RiskToKnownAdult)
        </MudItem>
        <MudItem xs="8">
            <MudToggleGroup @bind-Value="@Model.RiskToKnownAdult" Class="readonly-toggle" CheckMark>
                <MudToggleItem Value="@RiskLevel.Unknown">@RiskLevel.Unknown.Name</MudToggleItem>
                <MudToggleItem Value="@RiskLevel.Low">@RiskLevel.Low.Name</MudToggleItem>
                <MudToggleItem Value="@RiskLevel.Medium">@RiskLevel.Medium.Name</MudToggleItem>
                <MudToggleItem Value="@RiskLevel.High">@RiskLevel.High.Name</MudToggleItem>
                <MudToggleItem Value="@RiskLevel.VeryHigh">@RiskLevel.VeryHigh.Name</MudToggleItem>
            </MudToggleGroup>
            <MudTextField ReadOnly Underline="false" For="@(() => Model.RiskToKnownAdult)" hidden />
        </MudItem>
        @* Risk to Staff *@
        <MudDivider Class="mt-6" />
        <MudItem xs="4">
            @Model.GetMemberDescription(x => x.RiskToStaff)
        </MudItem>
        <MudItem xs="8">
            <MudToggleGroup @bind-Value="@Model.RiskToStaff" Class="readonly-toggle" CheckMark>
                <MudToggleItem Value="@RiskLevel.Unknown">@RiskLevel.Unknown.Name</MudToggleItem>
                <MudToggleItem Value="@RiskLevel.Low">@RiskLevel.Low.Name</MudToggleItem>
                <MudToggleItem Value="@RiskLevel.Medium">@RiskLevel.Medium.Name</MudToggleItem>
                <MudToggleItem Value="@RiskLevel.High">@RiskLevel.High.Name</MudToggleItem>
                <MudToggleItem Value="@RiskLevel.VeryHigh">@RiskLevel.VeryHigh.Name</MudToggleItem>
            </MudToggleGroup>
            <MudTextField ReadOnly Underline="false" For="@(() => Model.RiskToStaff)" hidden />
        </MudItem>
        @if (Community == false)
        {
            @* Risk to Other Prisoners *@
            <MudDivider Class="mt-6" />
            <MudItem xs="4">
                @Model.GetMemberDescription(x => x.RiskToOtherPrisoners)
            </MudItem>
            <MudItem xs="8">
                <MudToggleGroup @bind-Value="@Model.RiskToOtherPrisoners" Class="readonly-toggle" CheckMark>
                    <MudToggleItem Value="@RiskLevel.Unknown">@RiskLevel.Unknown.Name</MudToggleItem>
                    <MudToggleItem Value="@RiskLevel.Low">@RiskLevel.Low.Name</MudToggleItem>
                    <MudToggleItem Value="@RiskLevel.Medium">@RiskLevel.Medium.Name</MudToggleItem>
                    <MudToggleItem Value="@RiskLevel.High">@RiskLevel.High.Name</MudToggleItem>
                    <MudToggleItem Value="@RiskLevel.VeryHigh">@RiskLevel.VeryHigh.Name</MudToggleItem>
                </MudToggleGroup>
                <MudTextField ReadOnly Underline="false" For="@(() => Model.RiskToOtherPrisoners)" hidden />
            </MudItem>
        }
        @* Risk to Self *@
        <MudDivider Class="mt-6" />
        @if (ReadOnly && Model.RiskToSelf is not null)
        {
        <MudItem xs="4">
            @Model.GetMemberDescription(x => x.RiskToSelf)
        </MudItem>
        <MudItem xs="8">
            <MudToggleGroup @bind-Value="@Model.RiskToSelf" Class="readonly-toggle" CheckMark>
                <MudToggleItem Value="@RiskLevel.Unknown">@RiskLevel.Unknown.Name</MudToggleItem>
                <MudToggleItem Value="@RiskLevel.Low">@RiskLevel.Low.Name</MudToggleItem>
                <MudToggleItem Value="@RiskLevel.Medium">@RiskLevel.Medium.Name</MudToggleItem>
                <MudToggleItem Value="@RiskLevel.High">@RiskLevel.High.Name</MudToggleItem>
                <MudToggleItem Value="@RiskLevel.VeryHigh">@RiskLevel.VeryHigh.Name</MudToggleItem>
            </MudToggleGroup>
            <MudTextField ReadOnly Underline="false" For="@(() => Model.RiskToSelf)" hidden />
        </MudItem>
        }
        else
        {
        <MudItem xs="4">
            @Model.GetMemberDescription(x => x.RiskToSelfNew)
        </MudItem>
        <MudItem xs="8">
            <MudToggleGroup Class="readonly-toggle" @bind-Value="@Model.RiskToSelfNew" CheckMark>
                <MudToggleItem T="bool?" Value="false">@ConfirmationStatus.No.Name</MudToggleItem>
                <MudToggleItem T="bool?" Value="true">@ConfirmationStatus.Yes.Name</MudToggleItem>
            </MudToggleGroup>
            <MudTextField ReadOnly Underline="false" For="@(() => Model.RiskToSelfNew)" hidden />
        </MudItem>
        }
    </MudGrid>
</MudForm>

@code {
    [Parameter, EditorRequired]
    public required RiskDto.RiskDetail Model { get; set; }
    [Parameter]
    public bool Community { get; set; } = false;
    
    [CascadingParameter]
    public MudForm? Form { get; set; }

    public bool ReadOnly { get; private set; } = false;

    protected override Task OnInitializedAsync()
    {
        if (Form is not null)
        {
            ReadOnly = Form.ReadOnly;
        }

        return base.OnInitializedAsync();
    }
}