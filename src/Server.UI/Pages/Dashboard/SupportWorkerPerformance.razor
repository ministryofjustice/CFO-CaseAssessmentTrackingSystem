@using Cfo.Cats.Application.Features.Identity.DTOs
@using Cfo.Cats.Application.SecurityConstants
@using Cfo.Cats.Server.UI.Components.Dashboard
@using Cfo.Cats.Server.UI.Components.Users
@using Cfo.Cats.Server.UI.Pages.Dashboard.Components

@page "/pages/dashboard/supportworker/performance"
@attribute [Authorize(Policy = SecurityPolicies.AuthorizedUser)]


<MudStack Row="true" Justify="Justify.SpaceBetween">
    <MudText Typo="Typo.h3">
        Support Worker Performance Dashboard
    </MudText>
    <MudAlert Severity="Severity.Info" Variant="Variant.Filled">
        This page is still under development.
    </MudAlert>
    <MudSwitch 
        @bind-Value="_visualMode"
        T="bool" 
        ThumbIcon="@Icons.Material.Filled.StackedBarChart" 
        Color="Color.Primary">
        Visual Mode
    </MudSwitch>
</MudStack>



<MudStack>

    @if (_showSelect)
    {
        <UserSelectComponent ValueChanged="dto => { OnUserSelectedChanged(dto);  }" />    
    }

    @if(SelectedUserId is null)
    {
        <MudAlert Severity="Severity.Info" Variant="Variant.Outlined">
            Please select a user.
        </MudAlert>
    }

    @if (SelectedUserId is not null)
    {

        <MudTabs Outlined="true" ApplyEffectsToContainer="true">
            <MudTabPanel Text="Performance Overview" Icon="@Icons.Material.Filled.DataExploration">
				<MudDateRangePicker DateFormat="dddd, dd MMMM, yyyy" TitleDateFormat="MMMM dd" @bind-DateRange="@_dateRange" MaxDate="DateTime.Today" MinDate="@(new DateTime(2025, 1, 1))" Class="pa-2" />
				
                <MudTabs Outlined="true" ApplyEffectsToContainer="true" Centered="true" Color="Color.Primary">
                    <MudTabPanel Text="Enrolments" Class="pa-3">
                        <SupportWorkerEnrolmentDashboardComponent DateRange="@_dateRange" UserId="@SelectedUserId" @key="SelectedUserId + (_dateRange.Start?.Ticks ?? 0) + (_dateRange.End?.Ticks ?? 0)" VisualMode="@_visualMode" />
                    </MudTabPanel>
                    <MudTabPanel Text="Inductions" Class="pa-3">
                        <SupportWorkerInductionDashboardComponent DateRange="@_dateRange" UserId="@SelectedUserId" @key="SelectedUserId + (_dateRange.Start?.Ticks ?? 0) + (_dateRange.End?.Ticks ?? 0)" VisualMode="@_visualMode" />
                    </MudTabPanel>
                    <MudTabPanel Text="Activities">
                    </MudTabPanel>
                    <MudTabPanel Text="ETE">
                        <SupportWorkerEducationDashboardComponent DateRange="@_dateRange" UserId="@SelectedUserId" @key="SelectedUserId + (_dateRange.Start?.Ticks ?? 0) + (_dateRange.End?.Ticks ?? 0)" VisualMode="@_visualMode" />
                    </MudTabPanel>
                    <MudTabPanel Text="Employment">
                        <SupportWorkerEmploymentDashboardComponent DateRange="@_dateRange" UserId="@SelectedUserId" @key="SelectedUserId + (_dateRange.Start?.Ticks ?? 0) + (_dateRange.End?.Ticks ?? 0)" VisualMode="@_visualMode" />
                    </MudTabPanel>
                    <MudTabPanel Text="PRI">
                    </MudTabPanel>
                </MudTabs>
            </MudTabPanel>
            <MudTabPanel Text="Cases Location Breakdown" Icon="@Icons.Material.Filled.People">
                <CasesPerLocationPerSupportWorkerCardComponent UserId="@SelectedUserId" @key="@SelectedUserId" VisualMode="@_visualMode" />
            </MudTabPanel>
        </MudTabs>

    }
    
</MudStack>