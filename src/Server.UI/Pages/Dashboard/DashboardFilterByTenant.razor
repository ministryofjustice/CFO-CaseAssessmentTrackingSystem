@using Cfo.Cats.Application.Features.Identity.DTOs
@using Cfo.Cats.Application.SecurityConstants
@using Cfo.Cats.Server.UI.Components.Dashboard
@using Cfo.Cats.Server.UI.Components.Users
@using Cfo.Cats.Server.UI.Pages.Dashboard.Components
@using Cfo.Cats.Application.Common.Interfaces.MultiTenant

@page "/pages/dashboard/dashboardfilterbytenant"
@attribute [Authorize(Policy = SecurityPolicies.AuthorizedUser)]
@inject ITenantService TenantsService


<MudStack Row="true" Justify="Justify.SpaceBetween" AlignItems="AlignItems.Center">
    <MudText Typo="Typo.h3">
        Support Worker Dashboard
    </MudText>
    <MudAlert Severity="Severity.Warning" Variant="Variant.Outlined">
        This page is still under development and may produce inaccurate results.
    </MudAlert>
	<MudStack Row="true" AlignItems="AlignItems.Center">

		<MudDateRangePicker @ref="_picker" DateFormat="dd MMM yyyy" TitleDateFormat="MMMM dd" @bind-DateRange="@_dateRange" MaxDate="DateTime.Today" MinDate="@(new DateTime(2025, 1, 1))" Class="pa-2">
			<PickerActions>
				<MudButton OnClick="@(() => _picker.CloseAsync(false))">Cancel</MudButton>
				<MudButton Color="Color.Primary" OnClick="@(() => _picker.CloseAsync())">OK</MudButton>
			</PickerActions>
		</MudDateRangePicker>

		@if (CurrentUser.AssignedRoles is not [])
		{
			<MudLink OnClick="DisplayOptionsDialog" Disabled="@(CurrentUser.AssignedRoles is [])">
				@SelectedDisplayName
			</MudLink>
		}
                   @* <MudSelect T="string" ValueChanged="OnChangedListView" Value="@_selectedTenantId" Dense="false" Label="Tenant" Clearable="true"
                               Style="min-width: 300px;" Placeholder="Select a tenant">
                        @foreach (var item in TenantsService.DataSource.Where(x => x.Id.StartsWith(CurrentUser!.TenantId!)).OrderBy(t => t.Id))
                        {
                            <MudSelectItem T="string" Value="@item.Id">
                                @item.Name  
                            </MudSelectItem>
                        }
                    </MudSelect> *@
		<MudSwitch @bind-Value="_visualMode"
				   T="bool"
				   ThumbIcon="@Icons.Material.Filled.StackedBarChart"
				   Color="Color.Primary">
			Visual Mode
		</MudSwitch>
	</MudStack>
</MudStack>



<MudStack>
	@if(SelectedTenantId is null)
    {
        <MudAlert Severity="Severity.Info" Variant="Variant.Outlined">
            Please select a Tenant.
        </MudAlert>
    }

    @if (SelectedTenantId is not null)
    {
		<MudTabs PanelClass="pa-6" ApplyEffectsToContainer="true" Outlined="true">
			<MudTabPanel Text="Location Breakdown">
				<MudAlert Severity="Severity.Info">
					This page is not affected by the date range selector. It is a breakdown of all cases assigned to @SelectedDisplayName
					and their current status.
				</MudAlert>
				<CasesPerLocationPerSupportWorkerCardComponent TenantId="@SelectedTenantId" @key="@SelectedTenantId" VisualMode="@_visualMode" />
			</MudTabPanel>
			<MudTabPanel Text="Enrolments" Class="pa-3">
				<SupportWorkerEnrolmentDashboardComponent DateRange="@_dateRange" TenantId="@SelectedTenantId" @key="SelectedTenantId + (_dateRange.Start?.Ticks ?? 0) + (_dateRange.End?.Ticks ?? 0)" VisualMode="@_visualMode" />
			</MudTabPanel>
			<MudTabPanel Text="Inductions" Class="pa-3">
				<SupportWorkerInductionDashboardComponent DateRange="@_dateRange" TenantId="@SelectedTenantId" @key="SelectedTenantId + (_dateRange.Start?.Ticks ?? 0) + (_dateRange.End?.Ticks ?? 0)" VisualMode="@_visualMode" />
			</MudTabPanel>
			<MudTabPanel Text="Support &amp; Referral">
                <SupportWorkerPRIDashboardComponent DateRange="@_dateRange" TenantId="@SelectedTenantId" @key="SelectedTenantId + (_dateRange.Start?.Ticks ?? 0) + (_dateRange.End?.Ticks ?? 0)" VisualMode="@_visualMode" />
            </MudTabPanel>
			<MudTabPanel Text="Activities">
                <MudGrid Spacing="4">
                    <MudItem xs="12" sm="12" md="12" lg="12">
                        <SupportWorkerCommencedActivityDashboardComponent DateRange="@_dateRange" TenantId="@SelectedTenantId" @key="SelectedTenantId + (_dateRange.Start?.Ticks ?? 0) + (_dateRange.End?.Ticks ?? 0)" VisualMode="@_visualMode" />
                    </MudItem>
                    <MudItem xs="12" sm="6" md="6" lg="6">
                        <SupportWorkerApprovedActivityDashboardComponent DateRange="@_dateRange" TenantId="@SelectedTenantId" @key="SelectedTenantId + (_dateRange.Start?.Ticks ?? 0) + (_dateRange.End?.Ticks ?? 0)" VisualMode="@_visualMode" />
                    </MudItem>
                    <MudItem xs="12" sm="6" md="6" lg="6">
                        <SupportWorkerPaidActivityComponent DateRange="@_dateRange" TenantId="@SelectedTenantId" @key="SelectedTenantId + (_dateRange.Start?.Ticks ?? 0) + (_dateRange.End?.Ticks ?? 0)" VisualMode="@_visualMode" />
                    </MudItem>
                </MudGrid>
            </MudTabPanel>
            <MudTabPanel Text="Education &amp; Training">
                <SupportWorkerEducationDashboardComponent DateRange="@_dateRange" TenantId="@SelectedTenantId" @key="SelectedTenantId + (_dateRange.Start?.Ticks ?? 0) + (_dateRange.End?.Ticks ?? 0)" VisualMode="@_visualMode" />
            </MudTabPanel>
            <MudTabPanel Text="Employment">
                <SupportWorkerEmploymentDashboardComponent DateRange="@_dateRange" TenantId="@SelectedTenantId" @key="SelectedTenantId + (_dateRange.Start?.Ticks ?? 0) + (_dateRange.End?.Ticks ?? 0)" VisualMode="@_visualMode" />
            </MudTabPanel>
			<MudTabPanel Text="Reassessments" Class="pa-3">
                <SupportWorkerReassessmentDashboardComponent DateRange="@_dateRange" UserId="@CurrentUser.UserId" @key="CurrentUser.UserId + (_dateRange.Start?.Ticks ?? 0) + (_dateRange.End?.Ticks ?? 0)" VisualMode="@_visualMode" />
            </MudTabPanel>

		</MudTabs>
    }
    
</MudStack>
