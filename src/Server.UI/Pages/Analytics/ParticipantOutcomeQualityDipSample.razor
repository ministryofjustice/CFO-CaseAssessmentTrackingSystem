@using Cfo.Cats.Application.SecurityConstants
@using Cfo.Cats.Server.UI.Pages.Analytics.Components


@attribute [Authorize(Policy = SecurityPolicies.OutcomeQualityDipChecks)]

@page "/pages/analytics/outcome-quality-dip-sampling/{SampleId:guid}/{ParticipantId}"

@inherits CatsComponentBase

<style>
    .readonly-toggle {
        pointer-events: none;
        filter: grayscale(100%);
    }

    .two-columns {
        display: grid;
        grid-template-columns: repeat(2, 1fr); /* Two columns */
        gap: 10px; /* Adjust the gap between items as needed */
    }

    .toggle-item {
        box-sizing: border-box; /* Ensure padding and borders are included in width/height */
        padding: 10px; /* Add padding if needed */
        justify-content: left !important;
    }
</style>

<MudContainer Style="min-width: 480px; width: 100%;" MaxWidth="MaxWidth.ExtraExtraLarge">
    @if (_isLoading)
    {
        <MudLoading Text="Loading sample" Color="Color.Primary"/>
    }

    @if (_isLoading == false && _error is not null)
    {
        <MudAlert Severity="Severity.Error">
            <MudText>
                @_error
            </MudText>
        </MudAlert>
    }

    @if (_isLoading == false && _participant is not null)
    {
        <CatsBreadcrumbs Items="@Items"></CatsBreadcrumbs>

        <MudGrid Style="height: 100vh; width: 100%;">
            <MudItem xs="2">
                <MudStack style="align-self: flex-start; position: sticky; top: 16px; width: 100%;" Class="mr-2" Wrap="Wrap.Wrap">
                    <MudTextField ReadOnly="true" Label="Participant Id" Value="_participant.ParticipantId"/>
                    <MudTextField ReadOnly="true" Label="First Name" Value="_participant.FirstName"/>
                    <MudTextField ReadOnly="true" Label="Last Name" Value="_participant.LastName"/>
                    <MudTextField ReadOnly="true" Label="Date Of Birth" Value="_participant.DateOfBirth"/>
                    <MudTextField ReadOnly="true" Label="Nationality" Value="_participant.Nationality"/>
                    <MudTextField ReadOnly="true" Label="Current Owner" Value="_participant.SupportWorker"/>
                    <MudTextField ReadOnly="true" Label="Enrolment Location" Value="_participant.EnrolmentLocation"/>
                    <MudTextField ReadOnly="true" Label="Current Location" Value="_participant.CurrentLocation"/>
                </MudStack>
            </MudItem>

            <MudItem xs="10" Style="height: 100%; width: 100%;">
                <MudTabs>
                    <MudTabPanel Text="Events">
                        <div style="height: calc(100vh - 250px); overflow-y: auto;">
                            <OutcomeQualityDipSampleTimelineComponent Participant="_participant"/>
                        </div>
                    </MudTabPanel>
                    <MudTabPanel Text="Details">
                        <div style="height: calc(100vh - 250px); overflow-y: auto;">
                            <OutcomeQualityDipSamplePathwayPlanComponent ParticipantId="@_participant.ParticipantId"/>
                        </div>
                    </MudTabPanel>
                    <MudTabPanel Text="Assessments">
                        <div style="height: calc(100vh - 250px); overflow-y: auto;">
                            <OutcomeQualityDipSampleAssessmentComponent ParticipantId="@_participant.ParticipantId" />
                        </div>
                    </MudTabPanel>
                    <MudTabPanel Text="Submission">
                        <div style="height: calc(100vh - 250px); overflow-y: auto;">
                            <SubmitCsoResponseComponent Command="@SubmitCommand" OnFormSubmit="CsoResponseSubmitted" />
                        </div>
                    </MudTabPanel>
                </MudTabs>
            </MudItem>
        </MudGrid>
    }
</MudContainer>